<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¹ã‚¿ãƒ‡ã‚£GOãƒ»ãƒ‘ãƒ¼ã‚½ãƒŠãƒ« - ãƒ‡ãƒ¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap');
    body { font-family: 'Noto Sans JP', sans-serif; }

    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.4); opacity: 0; }
    }
    .pulse-ring { animation: pulse-ring 1.5s ease-out infinite; }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    .float { animation: float 3s ease-in-out infinite; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide-in { animation: slideIn 0.5s ease-out forwards; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in { animation: fadeIn 0.3s ease-out forwards; }

    @keyframes progressFill {
      from { width: 0; }
    }
    .progress-fill { animation: progressFill 1s ease-out forwards; }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .bounce { animation: bounce 0.6s ease-in-out; }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // ã‚¹ã‚¿ãƒ‡ã‚£GOãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼
            studygo: {
              mint: '#E0F7F6',
              mintLight: '#F0FAFA',
              cyan: '#00B4D8',
              cyanLight: '#48CAE4',
              cyanDark: '#0096C7',
              blue: '#0077B6',
              orange: '#F9A825',
              orangeLight: '#FFD54F',
              text: '#333333',
              textLight: '#666666',
              textMuted: '#999999',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-studygo-mint min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // APIè¨­å®š
    const API_BASE_URL = "http://localhost:3011";

    // Lucide Icons as React components
    const Icon = ({ name, size = 24, className = "" }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          if (className) icon.setAttribute('class', className);
          ref.current.appendChild(icon);
        }
      }, [name, size, className]);
      return <span ref={ref} className="inline-flex items-center justify-center" />;
    };

    // éƒ½é“åºœçœŒãƒãƒƒãƒ”ãƒ³ã‚°
    const prefectureNames = {
      1: "åŒ—æµ·é“", 2: "é’æ£®çœŒ", 3: "å²©æ‰‹çœŒ", 4: "å®®åŸçœŒ", 5: "ç§‹ç”°çœŒ", 6: "å±±å½¢çœŒ", 7: "ç¦å³¶çœŒ",
      8: "èŒ¨åŸçœŒ", 9: "æ ƒæœ¨çœŒ", 10: "ç¾¤é¦¬çœŒ", 11: "åŸ¼ç‰çœŒ", 12: "åƒè‘‰çœŒ", 13: "æ±äº¬éƒ½", 14: "ç¥å¥ˆå·çœŒ",
      15: "æ–°æ½ŸçœŒ", 16: "å¯Œå±±çœŒ", 17: "çŸ³å·çœŒ", 18: "ç¦äº•çœŒ", 19: "å±±æ¢¨çœŒ", 20: "é•·é‡çœŒ",
      21: "å²é˜œçœŒ", 22: "é™å²¡çœŒ", 23: "æ„›çŸ¥çœŒ", 24: "ä¸‰é‡çœŒ", 25: "æ»‹è³€çœŒ", 26: "äº¬éƒ½åºœ",
      27: "å¤§é˜ªåºœ", 28: "å…µåº«çœŒ", 29: "å¥ˆè‰¯çœŒ", 30: "å’Œæ­Œå±±çœŒ", 31: "é³¥å–çœŒ", 32: "å³¶æ ¹çœŒ",
      33: "å²¡å±±çœŒ", 34: "åºƒå³¶çœŒ", 35: "å±±å£çœŒ", 36: "å¾³å³¶çœŒ", 37: "é¦™å·çœŒ", 38: "æ„›åª›çœŒ",
      39: "é«˜çŸ¥çœŒ", 40: "ç¦å²¡çœŒ", 41: "ä½è³€çœŒ", 42: "é•·å´çœŒ", 43: "ç†Šæœ¬çœŒ", 44: "å¤§åˆ†çœŒ",
      45: "å®®å´çœŒ", 46: "é¹¿å…å³¶çœŒ", 47: "æ²–ç¸„çœŒ"
    };

    // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆAPIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
    const dummyStores = [
      { id: 1, name: "ã‚¹ã‚¿ãƒ‡ã‚£GO æ¸‹è°·Scramble", city: "æ¸‹è°·åŒº", prefecture: 13, catchCopy: "é§…ç›´çµã§24æ™‚é–“åˆ©ç”¨å¯èƒ½ãªæœ€æ–°è¨­å‚™ã®å­¦ç¿’ã‚¹ãƒšãƒ¼ã‚¹", reviewStar: 48, imageFileName: null },
      { id: 2, name: "ã‚¹ã‚¿ãƒ‡ã‚£GO æ–°å®¿West", city: "æ–°å®¿åŒº", prefecture: 13, catchCopy: "é™éŸ³ç’°å¢ƒã¨ã‚«ãƒ•ã‚§ä½µè¨­ã§ã‚†ã£ãŸã‚Šå­¦ç¿’", reviewStar: 47, imageFileName: null },
      { id: 3, name: "ã‚¹ã‚¿ãƒ‡ã‚£GO æ± è¢‹East", city: "è±Šå³¶åŒº", prefecture: 13, catchCopy: "åºƒã€…ç©ºé–“ã§ã‚°ãƒ«ãƒ¼ãƒ—å­¦ç¿’ã‚‚å¯èƒ½", reviewStar: 46, imageFileName: null },
    ];

    const dummyPlans = [
      { id: 1, name: "çŸ­æœŸé›†ä¸­ãƒ–ãƒ¼ã‚¹ãƒˆãƒ—ãƒ©ãƒ³", price: 29800, planType: 1, subTitle: "1ãƒ¶æœˆã§çµæœã‚’å‡ºã™", note: "æ¯æ—¥3æ™‚é–“ã®é›†ä¸­å­¦ç¿’ã€AIã‚³ãƒ¼ãƒãƒ³ã‚°é€±3å›", recommended: true },
      { id: 2, name: "ç¤¾ä¼šäººå¤œé–“ãƒ•ãƒ«æ´»ç”¨ãƒ—ãƒ©ãƒ³", price: 19800, planType: 1, subTitle: "ä»•äº‹å¸°ã‚Šã«å­¦ç¿’", note: "å¹³æ—¥18æ™‚ä»¥é™åˆ©ç”¨ã€é€±æœ«ãƒ•ãƒªãƒ¼åˆ©ç”¨", recommended: false },
      { id: 3, name: "é€±æœ«ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³", price: 14800, planType: 1, subTitle: "é€±æœ«ã ã‘ã§ç€å®Ÿã«", note: "åœŸæ—¥ç¥æ—¥åˆ©ç”¨ã€æœˆ2å›ã®å¯¾é¢æŒ‡å°", recommended: false },
    ];

    const roadmapPhases = [
      { phase: 1, title: "åŸºç¤å›ºã‚æœŸ", duration: "1-2é€±ç›®", tasks: ["å­¦ç¿’ç¿’æ…£ã®ç¢ºç«‹", "åŸºç¤çŸ¥è­˜ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", "ç›®æ¨™ã®æ˜ç¢ºåŒ–"], progress: 100, icon: "Sprout" },
      { phase: 2, title: "å®Ÿè·µå¿œç”¨æœŸ", duration: "3-4é€±ç›®", tasks: ["æ¼”ç¿’å•é¡Œã¸ã®æŒ‘æˆ¦", "å¼±ç‚¹ã®ç‰¹å®šã¨å…‹æœ", "å¿œç”¨åŠ›ã®é¤Šæˆ"], progress: 65, icon: "Zap" },
      { phase: 3, title: "ä»•ä¸Šã’æœŸ", duration: "5-6é€±ç›®", tasks: ["ç·å¾©ç¿’", "æ¨¡æ“¬ãƒ†ã‚¹ãƒˆ", "æœ¬ç•ªå¯¾ç­–"], progress: 30, icon: "Target" },
      { phase: 4, title: "ç›®æ¨™é”æˆ", duration: "7é€±ç›®ã€œ", tasks: ["æˆæœã®ç¢ºèª", "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸", "ç¶™ç¶šå­¦ç¿’ãƒ—ãƒ©ãƒ³"], progress: 0, icon: "Trophy" },
    ];

    // APIå‘¼ã³å‡ºã—é–¢æ•°
    const fetchShops = async (prefecture) => {
      try {
        const response = await fetch(`${API_BASE_URL}/app/shops`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prefecture: prefecture || undefined })
        });
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.data?.shops || [];
      } catch (error) {
        console.log('API unavailable, using dummy data:', error.message);
        return null;
      }
    };

    const fetchShopPlans = async (shopId) => {
      try {
        const response = await fetch(`${API_BASE_URL}/app/shopPlans`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ shopId })
        });
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.data?.shopPlans || [];
      } catch (error) {
        console.log('API unavailable, using dummy data:', error.message);
        return null;
      }
    };

    // AIãƒ­ãƒœãƒƒãƒˆã‚¤ãƒ©ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const StudyIllustration = () => (
      <svg viewBox="0 0 240 200" className="w-56 h-48 mx-auto float">
        {/* èƒŒæ™¯ã®å†† */}
        <circle cx="120" cy="100" r="70" fill="#E0F7F6" opacity="0.5" />

        {/* ãƒ­ãƒœãƒƒãƒˆæœ¬ä½“ */}
        <rect x="85" y="70" width="70" height="80" rx="20" fill="#00B4D8" />

        {/* ãƒ­ãƒœãƒƒãƒˆã®é¡” */}
        <rect x="95" y="80" width="50" height="45" rx="10" fill="#FFF" />

        {/* ç›® */}
        <circle cx="110" cy="100" r="8" fill="#333" />
        <circle cx="130" cy="100" r="8" fill="#333" />
        <circle cx="112" cy="98" r="3" fill="#FFF" />
        <circle cx="132" cy="98" r="3" fill="#FFF" />

        {/* å£ï¼ˆç¬‘é¡”ï¼‰ */}
        <path d="M108 115 Q120 125 132 115" stroke="#333" strokeWidth="3" fill="none" strokeLinecap="round" />

        {/* ã‚¢ãƒ³ãƒ†ãƒŠ */}
        <line x1="120" y1="70" x2="120" y2="50" stroke="#00B4D8" strokeWidth="4" />
        <circle cx="120" cy="45" r="8" fill="#F9A825" />
        <circle cx="120" cy="45" r="4" fill="#FFD54F" />

        {/* è€³ï¼ˆã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼‰ */}
        <rect x="70" y="90" width="15" height="25" rx="5" fill="#0096C7" />
        <rect x="155" y="90" width="15" height="25" rx="5" fill="#0096C7" />

        {/* æœ¬ */}
        <rect x="75" y="155" width="90" height="12" rx="3" fill="#48CAE4" />
        <rect x="80" y="145" width="80" height="10" rx="2" fill="#00B4D8" />
        <rect x="85" y="137" width="70" height="8" rx="2" fill="#0096C7" />

        {/* è£…é£¾ï¼šæ­¯è»Š */}
        <g transform="translate(45, 60)">
          <circle cx="0" cy="0" r="15" fill="#FFD54F" />
          <circle cx="0" cy="0" r="8" fill="#F9A825" />
          <rect x="-3" y="-18" width="6" height="8" fill="#FFD54F" />
          <rect x="-3" y="10" width="6" height="8" fill="#FFD54F" />
          <rect x="-18" y="-3" width="8" height="6" fill="#FFD54F" />
          <rect x="10" y="-3" width="8" height="6" fill="#FFD54F" />
        </g>

        {/* è£…é£¾ï¼šé›»çƒ */}
        <g transform="translate(195, 70)">
          <circle cx="0" cy="0" r="12" fill="#FFD54F" />
          <rect x="-5" y="10" width="10" height="6" rx="2" fill="#F9A825" />
          <line x1="0" y1="-20" x2="0" y2="-14" stroke="#F9A825" strokeWidth="2" />
          <line x1="-12" y1="-12" x2="-8" y2="-8" stroke="#F9A825" strokeWidth="2" />
          <line x1="12" y1="-12" x2="8" y2="-8" stroke="#F9A825" strokeWidth="2" />
        </g>

        {/* è£…é£¾ï¼šã‚­ãƒ©ã‚­ãƒ© */}
        <g fill="#48CAE4">
          <circle cx="55" cy="140" r="4" />
          <circle cx="185" cy="130" r="3" />
          <circle cx="175" cy="155" r="5" />
          <circle cx="65" cy="170" r="3" />
        </g>
      </svg>
    );

    const AIIllustration = () => (
      <svg viewBox="0 0 160 120" className="w-32 h-24 mx-auto">
        {/* ä¸­å¤®ã®AIãƒ­ãƒœãƒƒãƒˆ */}
        <circle cx="80" cy="60" r="35" fill="#E0F7F6" stroke="#00B4D8" strokeWidth="2" />

        {/* ãƒ­ãƒœãƒƒãƒˆé¡” */}
        <rect x="60" y="45" width="40" height="35" rx="8" fill="#00B4D8" />
        <rect x="65" y="50" width="30" height="20" rx="5" fill="#FFF" />
        <circle cx="73" cy="58" r="4" fill="#333" />
        <circle cx="87" cy="58" r="4" fill="#333" />
        <path d="M70 68 Q80 74 90 68" stroke="#333" strokeWidth="2" fill="none" strokeLinecap="round" />

        {/* ã‚¢ãƒ³ãƒ†ãƒŠ */}
        <line x1="80" y1="45" x2="80" y2="35" stroke="#00B4D8" strokeWidth="3" />
        <circle cx="80" cy="32" r="5" fill="#F9A825" />

        {/* æ¥ç¶šç·š */}
        <line x1="45" y1="60" x2="20" y2="40" stroke="#48CAE4" strokeWidth="2" strokeDasharray="4" />
        <line x1="115" y1="60" x2="140" y2="40" stroke="#48CAE4" strokeWidth="2" strokeDasharray="4" />
        <line x1="45" y1="70" x2="20" y2="90" stroke="#48CAE4" strokeWidth="2" strokeDasharray="4" />
        <line x1="115" y1="70" x2="140" y2="90" stroke="#48CAE4" strokeWidth="2" strokeDasharray="4" />

        {/* å‘¨è¾ºã‚¢ã‚¤ã‚³ãƒ³ */}
        <circle cx="20" cy="40" r="10" fill="#FFD54F" />
        <circle cx="140" cy="40" r="10" fill="#48CAE4" />
        <circle cx="20" cy="90" r="10" fill="#00B4D8" />
        <circle cx="140" cy="90" r="10" fill="#F9A825" />
      </svg>
    );

    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    function StudyGoPersonal() {
      const [step, setStep] = useState(0); // 0: ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°, 1: è³ªå•, 2: çµæœ
      const [questionStep, setQuestionStep] = useState(1);
      const [formData, setFormData] = useState({ purpose: "", area: "", budget: "", name: "" });
      const [stores, setStores] = useState([]);
      const [plans, setPlans] = useState([]);
      const [selectedStore, setSelectedStore] = useState(null);
      const [selectedPlan, setSelectedPlan] = useState(null);
      const [isAnalyzing, setIsAnalyzing] = useState(false);
      const [analysisProgress, setAnalysisProgress] = useState(0);
      const [showConfirmation, setShowConfirmation] = useState(false);
      const [isUsingApi, setIsUsingApi] = useState(false);
      const [isLoadingPlans, setIsLoadingPlans] = useState(false);

      const totalQuestions = 4;
      const purposes = ["è³‡æ ¼å–å¾—", "ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—", "è»¢è·æº–å‚™", "è¶£å‘³ãƒ»æ•™é¤Š"];
      const areas = [
        { label: "æ±äº¬éƒ½", value: 13 },
        { label: "ç¥å¥ˆå·çœŒ", value: 14 },
        { label: "å¤§é˜ªåºœ", value: 27 },
        { label: "ãã®ä»–", value: 0 }
      ];
      const budgets = ["ã€œ1ä¸‡å††", "1ã€œ2ä¸‡å††", "2ã€œ3ä¸‡å††", "3ä¸‡å††ä»¥ä¸Š"];

      const handleStoreSelect = async (store) => {
        setSelectedStore(store);
        setSelectedPlan(null);
        setIsLoadingPlans(true);

        const apiPlans = await fetchShopPlans(store.id);
        if (apiPlans && apiPlans.length > 0) {
          const formattedPlans = apiPlans.map((p, idx) => ({
            id: p.id,
            name: p.name,
            price: p.price,
            planType: p.planType,
            subTitle: p.subTitle || "",
            note: p.note || "",
            recommended: idx === 0
          }));
          setPlans(formattedPlans);
          setSelectedPlan(formattedPlans[0]);
        } else {
          setPlans(dummyPlans);
          setSelectedPlan(dummyPlans[0]);
        }
        setIsLoadingPlans(false);
      };

      const handleAnalyze = async () => {
        setIsAnalyzing(true);
        setAnalysisProgress(0);

        const selectedArea = areas.find(a => a.label === formData.area);
        const prefectureCode = selectedArea?.value || 0;

        let apiShops = null;
        const interval = setInterval(() => {
          setAnalysisProgress(prev => {
            if (prev >= 100) {
              clearInterval(interval);
              return 100;
            }
            return prev + Math.random() * 12;
          });
        }, 200);

        apiShops = await fetchShops(prefectureCode > 0 ? prefectureCode : undefined);

        await new Promise(resolve => setTimeout(resolve, 3000));

        clearInterval(interval);
        setAnalysisProgress(100);

        setTimeout(async () => {
          setIsAnalyzing(false);
          setStep(2); // çµæœç”»é¢ã¸

          if (apiShops && apiShops.length > 0) {
            const formattedStores = apiShops.slice(0, 5).map((s, idx) => ({
              id: s.id,
              name: s.name,
              city: s.city,
              prefecture: s.prefecture,
              catchCopy: s.catchCopy || "",
              reviewStar: s.reviewStar,
              imageFileName: s.imageFileName,
              recommended: idx === 0
            }));
            setStores(formattedStores);
            setIsUsingApi(true);
            await handleStoreSelect(formattedStores[0]);
          } else {
            setStores(dummyStores);
            setPlans(dummyPlans);
            setSelectedStore(dummyStores[0]);
            setSelectedPlan(dummyPlans[0]);
            setIsUsingApi(false);
          }
        }, 500);
      };

      const handleContract = () => {
        setShowConfirmation(true);
      };

      const nextQuestion = () => {
        // åå‰å…¥åŠ›ã®å ´åˆ
        if (questionStep === 1) {
          const input = document.getElementById('nameInput');
          const nameValue = input?.value?.trim() || '';
          if (nameValue.length === 0) {
            alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            input?.focus();
            return;
          }
          setFormData(prev => ({...prev, name: nameValue}));
          setQuestionStep(2);
          return;
        }

        if (questionStep < totalQuestions) {
          setQuestionStep(prev => prev + 1);
        } else {
          handleAnalyze();
        }
      };

      const prevQuestion = () => {
        if (questionStep > 1) {
          setQuestionStep(prev => prev - 1);
        }
      };

      // ãƒ˜ãƒƒãƒ€ãƒ¼
      const Header = () => (
        <header className="bg-white shadow-sm">
          <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-studygo-cyan rounded-lg flex items-center justify-center">
                <Icon name="GraduationCap" size={20} className="text-white" />
              </div>
              <span className="text-lg font-bold text-studygo-cyan">ã‚¹ã‚¿ãƒ‡ã‚£GO</span>
            </div>
            <nav className="hidden md:flex items-center gap-6 text-sm text-studygo-textLight">
              <a href="#" className="hover:text-studygo-cyan">ä¼šå“¡ç™»éŒ²</a>
              <a href="#" className="hover:text-studygo-cyan">ãƒ­ã‚°ã‚¤ãƒ³</a>
            </nav>
          </div>
        </header>
      );

      // è³ªå•ã‚«ãƒ¼ãƒ‰
      const QuestionCard = ({ children, title, subtitle }) => (
        <div className="bg-white rounded-3xl shadow-lg p-6 md:p-8 max-w-xl mx-auto">
          {/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ */}
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center gap-2">
              <div className="w-8 h-8 bg-studygo-cyan rounded-lg flex items-center justify-center">
                <Icon name="GraduationCap" size={18} className="text-white" />
              </div>
              <span className="font-bold text-studygo-cyan">ã‚¹ã‚¿ãƒ‡ã‚£GO</span>
            </div>
            <span className="text-studygo-cyan font-medium">{questionStep}/{totalQuestions} å•</span>
          </div>

          {/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */}
          <div className="h-2 bg-gray-100 rounded-full mb-8 overflow-hidden">
            <div
              className="h-full bg-studygo-cyan rounded-full transition-all duration-500"
              style={{ width: `${(questionStep / totalQuestions) * 100}%` }}
            />
          </div>

          {title && <h2 className="text-xl font-bold text-studygo-text mb-2">{title}</h2>}
          {subtitle && <p className="text-studygo-textMuted mb-6">{subtitle}</p>}
          {children}
        </div>
      );

      // è³ªå•ã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
      const getQuestionValidity = () => {
        switch(questionStep) {
          case 1: return true; // åå‰ã¯æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒã‚§ãƒƒã‚¯
          case 2: return formData.purpose.length > 0;
          case 3: return formData.area.length > 0;
          case 4: return formData.budget.length > 0;
          default: return false;
        }
      };

      // è³ªå•ãƒ•ã‚©ãƒ¼ãƒ ã®å†…å®¹ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      const renderQuestionContent = () => {
        switch(questionStep) {
          case 1:
            return (
              <div>
                <input
                  id="nameInput"
                  type="text"
                  defaultValue={formData.name}
                  placeholder="å±±ç”° å¤ªéƒ"
                  className="w-full px-5 py-4 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-studygo-cyan focus:border-studygo-cyan transition-all text-lg"
                />
                <p className="text-sm text-studygo-textMuted mt-2">å…¥åŠ›å¾Œã€ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
              </div>
            );
          case 2:
            return (
              <div className="space-y-3">
                {purposes.map((purpose) => (
                  <button
                    key={purpose}
                    onClick={() => setFormData(prev => ({...prev, purpose}))}
                    className={`w-full px-5 py-4 rounded-2xl border-2 transition-all flex items-center gap-4 ${
                      formData.purpose === purpose
                        ? 'border-studygo-cyan bg-studygo-mintLight'
                        : 'border-gray-200 hover:border-studygo-cyanLight hover:bg-gray-50'
                    }`}
                  >
                    <div className={`w-7 h-7 rounded-full border-2 flex items-center justify-center ${
                      formData.purpose === purpose
                        ? 'border-studygo-cyan bg-studygo-cyan'
                        : 'border-gray-300'
                    }`}>
                      {formData.purpose === purpose && <Icon name="Check" size={16} className="text-white" />}
                    </div>
                    <span className={`text-lg ${formData.purpose === purpose ? 'text-studygo-cyan font-medium' : 'text-studygo-text'}`}>
                      {purpose}
                    </span>
                  </button>
                ))}
              </div>
            );
          case 3:
            return (
              <div className="grid grid-cols-2 gap-3">
                {areas.map((area) => (
                  <button
                    key={area.label}
                    onClick={() => setFormData(prev => ({...prev, area: area.label}))}
                    className={`px-4 py-4 rounded-2xl border-2 transition-all ${
                      formData.area === area.label
                        ? 'border-studygo-cyan bg-studygo-mintLight text-studygo-cyan font-medium'
                        : 'border-gray-200 hover:border-studygo-cyanLight text-studygo-text'
                    }`}
                  >
                    {area.label}
                  </button>
                ))}
              </div>
            );
          case 4:
            return (
              <div className="grid grid-cols-2 gap-3">
                {budgets.map((budget) => (
                  <button
                    key={budget}
                    onClick={() => setFormData(prev => ({...prev, budget}))}
                    className={`px-4 py-4 rounded-2xl border-2 transition-all ${
                      formData.budget === budget
                        ? 'border-studygo-cyan bg-studygo-mintLight text-studygo-cyan font-medium'
                        : 'border-gray-200 hover:border-studygo-cyanLight text-studygo-text'
                    }`}
                  >
                    {budget}
                  </button>
                ))}
              </div>
            );
          default:
            return null;
        }
      };

      const getQuestionTitle = () => {
        const titles = ["Question 1", "Question 2", "Question 3", "Question 4"];
        return titles[questionStep - 1];
      };

      const getQuestionSubtitle = () => {
        const subtitles = [
          "ãŠåå‰ã‚’æ•™ãˆã¦ãã ã•ã„",
          "å­¦ç¿’ã®ç›®çš„ã¯ä½•ã§ã™ã‹ï¼Ÿ",
          "å¸Œæœ›ã‚¨ãƒªã‚¢ã¯ã©ã¡ã‚‰ã§ã™ã‹ï¼Ÿ",
          "æœˆé¡äºˆç®—ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ"
        ];
        return subtitles[questionStep - 1];
      };

      // ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢
      const LandingView = () => (
        <div className="slide-in">
          <div className="bg-white rounded-3xl shadow-lg p-8 md:p-10 max-w-xl mx-auto text-center">
            <StudyIllustration />

            <h1 className="text-2xl md:text-3xl font-bold text-studygo-text mt-6 mb-3">
              ã‚ãªãŸã¯ã©ã®å­¦ç¿’ã‚¿ã‚¤ãƒ—ï¼Ÿ<br />
              ã€œæœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’è¦‹ã¤ã‘ã‚ˆã†ã€œ
            </h1>
            <p className="text-studygo-textMuted mb-8">
              4ã¤ã®è³ªå•ã«ç­”ãˆã‚‹ã ã‘ï¼<br />
              AIãŒã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®å­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã—ã¾ã™
            </p>

            <button
              onClick={() => setStep(1)}
              className="w-full max-w-xs mx-auto py-4 bg-studygo-cyan text-white font-bold rounded-full hover:bg-studygo-cyanDark transition-all shadow-lg shadow-studygo-cyan/30 text-lg"
            >
              ä»Šã™ãè¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
          </div>

          {/* ç‰¹å¾´ã‚«ãƒ¼ãƒ‰ */}
          <div className="mt-6 max-w-md mx-auto">
            <div className="bg-white rounded-2xl p-6 shadow-md text-center">
              <AIIllustration />
              <p className="text-studygo-text font-medium mt-4">
                AIæ­è¼‰ã§ã‚ãªãŸã®å­¦ç¿’ã‚¿ã‚¤ãƒ—ã‚’åˆ†æ
              </p>
              <p className="text-studygo-textMuted text-sm mt-1">
                æœ€é©ãªåº—èˆ—ã¨ãƒ—ãƒ©ãƒ³ã‚’ãƒãƒƒãƒãƒ³ã‚°ï¼
              </p>
            </div>
          </div>
        </div>
      );

      // åˆ†æä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      const AnalyzingAnimation = () => (
        <div className="text-center py-8">
          <div className="bg-white rounded-3xl shadow-lg p-8 max-w-md mx-auto">
            <div className="relative inline-flex items-center justify-center mb-8">
              <div className="absolute w-28 h-28 bg-studygo-mintLight rounded-full pulse-ring"></div>
              <div className="absolute w-20 h-20 bg-studygo-mint rounded-full pulse-ring" style={{animationDelay: '0.5s'}}></div>
              <div className="w-16 h-16 bg-studygo-cyan rounded-full flex items-center justify-center">
                <Icon name="Brain" size={32} className="text-white" />
              </div>
            </div>

            <h2 className="text-xl font-bold text-studygo-text mb-2">AIãŒåˆ†æä¸­...</h2>
            <p className="text-studygo-textMuted mb-6">{formData.name}ã•ã‚“ã®å­¦ç¿’ã‚¿ã‚¤ãƒ—ã‚’è¨ºæ–­ã—ã¦ã„ã¾ã™</p>

            <div className="h-3 bg-gray-100 rounded-full overflow-hidden mb-2">
              <div
                className="h-full bg-studygo-cyan rounded-full transition-all duration-300"
                style={{width: `${Math.min(analysisProgress, 100)}%`}}
              ></div>
            </div>
            <p className="text-sm text-studygo-textMuted">{Math.round(Math.min(analysisProgress, 100))}%</p>

            <div className="mt-6 space-y-2 text-left">
              {analysisProgress > 20 && (
                <div className="flex items-center gap-3 fade-in">
                  <div className="w-6 h-6 bg-studygo-cyan rounded-full flex items-center justify-center">
                    <Icon name="Check" size={14} className="text-white" />
                  </div>
                  <span className="text-studygo-text">å­¦ç¿’ç›®çš„ã‚’åˆ†æä¸­...</span>
                </div>
              )}
              {analysisProgress > 45 && (
                <div className="flex items-center gap-3 fade-in">
                  <div className="w-6 h-6 bg-studygo-cyan rounded-full flex items-center justify-center">
                    <Icon name="Check" size={14} className="text-white" />
                  </div>
                  <span className="text-studygo-text">æœ€é©ãªåº—èˆ—ã‚’æ¤œç´¢ä¸­...</span>
                </div>
              )}
              {analysisProgress > 70 && (
                <div className="flex items-center gap-3 fade-in">
                  <div className="w-6 h-6 bg-studygo-cyan rounded-full flex items-center justify-center">
                    <Icon name="Check" size={14} className="text-white" />
                  </div>
                  <span className="text-studygo-text">ãƒ—ãƒ©ãƒ³ã‚’ãƒãƒƒãƒãƒ³ã‚°ä¸­...</span>
                </div>
              )}
              {analysisProgress > 90 && (
                <div className="flex items-center gap-3 fade-in">
                  <div className="w-6 h-6 bg-studygo-cyan rounded-full flex items-center justify-center">
                    <Icon name="Check" size={14} className="text-white" />
                  </div>
                  <span className="text-studygo-text">ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’ç”Ÿæˆä¸­...</span>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      // ã‚¹ãƒ†ãƒƒãƒ—2: çµæœç”»é¢
      const ResultView = () => (
        <div className="slide-in space-y-6">
          {/* è¨ºæ–­çµæœãƒ˜ãƒƒãƒ€ãƒ¼ */}
          <div className="bg-white rounded-3xl shadow-lg p-6 md:p-8 text-center">
            <div className="inline-flex items-center gap-2 px-4 py-2 bg-studygo-mintLight rounded-full text-studygo-cyan font-medium mb-4">
              <Icon name="Sparkles" size={18} />
              è¨ºæ–­çµæœ
            </div>
            <h2 className="text-2xl font-bold text-studygo-text mb-2">
              {formData.name}ã•ã‚“ã¯<br />
              <span className="text-studygo-cyan">ã€{formData.purpose}å‹ã€‘</span>å­¦ç¿’ã‚¿ã‚¤ãƒ—ï¼
            </h2>
            <p className="text-studygo-textMuted">
              ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®å­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™
            </p>
            {isUsingApi && (
              <span className="inline-flex items-center gap-1 mt-3 px-3 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">
                <Icon name="Database" size={12} />
                å®Ÿãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ä¸­
              </span>
            )}
          </div>

          {/* ãŠã™ã™ã‚åº—èˆ— */}
          <div className="bg-white rounded-3xl shadow-lg p-6">
            <h3 className="text-lg font-bold text-studygo-text mb-4 flex items-center gap-2">
              <Icon name="MapPin" size={20} className="text-studygo-cyan" />
              ãŠã™ã™ã‚åº—èˆ—
            </h3>
            <div className="space-y-3">
              {stores.slice(0, 3).map((store, idx) => (
                <div
                  key={store.id}
                  onClick={() => handleStoreSelect(store)}
                  className={`p-4 rounded-2xl border-2 cursor-pointer transition-all ${
                    selectedStore?.id === store.id
                      ? 'border-studygo-cyan bg-studygo-mintLight'
                      : 'border-gray-100 hover:border-studygo-cyanLight bg-gray-50'
                  }`}
                >
                  <div className="flex items-start gap-4">
                    <div className="w-14 h-14 bg-studygo-mint rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                      ğŸ¢
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-bold text-studygo-text truncate">{store.name}</span>
                        {idx === 0 && (
                          <span className="px-2 py-0.5 bg-studygo-orange text-white text-xs font-medium rounded-full flex-shrink-0">
                            ãŠã™ã™ã‚
                          </span>
                        )}
                      </div>
                      <div className="flex items-center gap-1 text-sm text-studygo-textMuted mb-1">
                        <Icon name="MapPin" size={14} />
                        <span>{prefectureNames[store.prefecture]} {store.city}</span>
                      </div>
                      {store.reviewStar && (
                        <div className="flex items-center gap-1 text-sm text-studygo-orange">
                          <Icon name="Star" size={14} />
                          <span>{(store.reviewStar / 10).toFixed(1)}</span>
                        </div>
                      )}
                    </div>
                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${
                      selectedStore?.id === store.id ? 'border-studygo-cyan bg-studygo-cyan' : 'border-gray-300'
                    }`}>
                      {selectedStore?.id === store.id && <Icon name="Check" size={14} className="text-white" />}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* ãŠã™ã™ã‚ãƒ—ãƒ©ãƒ³ */}
          <div className="bg-white rounded-3xl shadow-lg p-6">
            <h3 className="text-lg font-bold text-studygo-text mb-4 flex items-center gap-2">
              <Icon name="Zap" size={20} className="text-studygo-orange" />
              ãŠã™ã™ã‚ãƒ—ãƒ©ãƒ³
              {isLoadingPlans && <span className="text-sm text-studygo-textMuted font-normal">èª­ã¿è¾¼ã¿ä¸­...</span>}
            </h3>
            <div className="space-y-3">
              {plans.map((plan, idx) => (
                <div
                  key={plan.id}
                  onClick={() => setSelectedPlan(plan)}
                  className={`p-4 rounded-2xl border-2 cursor-pointer transition-all relative overflow-hidden ${
                    selectedPlan?.id === plan.id
                      ? 'border-studygo-cyan bg-studygo-mintLight'
                      : 'border-gray-100 hover:border-studygo-cyanLight bg-gray-50'
                  }`}
                >
                  {idx === 0 && (
                    <div className="absolute top-0 right-0 px-3 py-1 bg-studygo-orange text-white text-xs font-medium rounded-bl-xl">
                      AIãŠã™ã™ã‚
                    </div>
                  )}
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-3">
                      <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                        selectedPlan?.id === plan.id ? 'border-studygo-cyan bg-studygo-cyan' : 'border-gray-300'
                      }`}>
                        {selectedPlan?.id === plan.id && <Icon name="Check" size={14} className="text-white" />}
                      </div>
                      <div>
                        <span className="font-bold text-studygo-text">{plan.name}</span>
                        {plan.subTitle && <span className="ml-2 text-sm text-studygo-textMuted">({plan.subTitle})</span>}
                      </div>
                    </div>
                    <div className="text-right">
                      <span className="text-2xl font-bold text-studygo-cyan">Â¥{plan.price.toLocaleString()}</span>
                      <span className="text-sm text-studygo-textMuted">/æœˆ</span>
                    </div>
                  </div>
                  {plan.note && (
                    <p className="text-sm text-studygo-textMuted ml-9">{plan.note}</p>
                  )}
                </div>
              ))}
            </div>
          </div>

          {/* ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— */}
          <div className="bg-white rounded-3xl shadow-lg p-6">
            <h3 className="text-lg font-bold text-studygo-text mb-4 flex items-center gap-2">
              <Icon name="Route" size={20} className="text-studygo-cyan" />
              ã‚ãªãŸã®å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
            </h3>
            <div className="relative">
              {roadmapPhases.map((phase, idx) => (
                <div key={phase.phase} className="flex gap-4 mb-4 last:mb-0">
                  <div className="flex flex-col items-center">
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                      phase.progress === 100 ? 'bg-green-500' : phase.progress > 0 ? 'bg-studygo-cyan' : 'bg-gray-200'
                    }`}>
                      <Icon name={phase.icon} size={20} className="text-white" />
                    </div>
                    {idx < roadmapPhases.length - 1 && (
                      <div className="w-0.5 flex-1 min-h-[40px] bg-gray-200 my-2">
                        <div className="w-full bg-studygo-cyan" style={{height: `${phase.progress}%`}}></div>
                      </div>
                    )}
                  </div>
                  <div className="flex-1 pb-2">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-bold text-studygo-text">Phase {phase.phase}: {phase.title}</span>
                      <span className="text-xs text-studygo-textMuted bg-gray-100 px-2 py-0.5 rounded-full">{phase.duration}</span>
                    </div>
                    <ul className="space-y-1">
                      {phase.tasks.map(task => (
                        <li key={task} className="text-sm text-studygo-textLight flex items-center gap-2">
                          <span className={`w-1.5 h-1.5 rounded-full ${phase.progress > 0 ? 'bg-studygo-cyan' : 'bg-gray-300'}`}></span>
                          {task}
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* å¥‘ç´„ãƒœã‚¿ãƒ³ */}
          <div className="bg-studygo-cyan rounded-3xl p-6 text-white">
            <div className="flex items-center justify-between mb-4">
              <div>
                <p className="text-sm opacity-80">é¸æŠä¸­ã®ãƒ—ãƒ©ãƒ³</p>
                <p className="text-xl font-bold">{selectedPlan?.name || "ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ"}</p>
                {selectedStore && <p className="text-sm opacity-80 mt-1">@ {selectedStore.name}</p>}
              </div>
              <div className="text-right">
                <p className="text-sm opacity-80">æœˆé¡</p>
                <p className="text-3xl font-bold">Â¥{(selectedPlan?.price || 0).toLocaleString()}</p>
              </div>
            </div>
            <button
              onClick={handleContract}
              disabled={!selectedStore || !selectedPlan}
              className="w-full py-4 bg-white text-studygo-cyan font-bold rounded-full hover:bg-gray-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg text-lg"
            >
              ã“ã®ãƒ—ãƒ©ãƒ³ã§å­¦ç¿’ã‚’é–‹å§‹ã™ã‚‹
            </button>
            <p className="text-center text-sm mt-3 opacity-80">
              14æ—¥é–“ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä»˜ããƒ»ã„ã¤ã§ã‚‚è§£ç´„å¯èƒ½
            </p>
          </div>
        </div>
      );

      // å¥‘ç´„å®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ«
      const ConfirmationModal = () => (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-3xl p-8 max-w-md w-full text-center slide-in">
            <div className="w-20 h-20 bg-studygo-cyan rounded-full flex items-center justify-center mx-auto mb-6">
              <Icon name="PartyPopper" size={40} className="text-white" />
            </div>
            <h2 className="text-2xl font-bold text-studygo-text mb-2">ãŠç”³ã—è¾¼ã¿å®Œäº†ï¼</h2>
            <p className="text-studygo-textMuted mb-6">
              {formData.name}ã•ã‚“ã®å­¦ç¿’ãŒã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚<br />
              ä¸€ç·’ã«ç›®æ¨™é”æˆã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼
            </p>

            <div className="bg-studygo-mintLight rounded-2xl p-4 mb-6 text-left">
              <div className="flex justify-between items-center mb-2">
                <span className="text-studygo-textMuted">åº—èˆ—</span>
                <span className="font-medium text-studygo-text text-right text-sm">{selectedStore?.name}</span>
              </div>
              <div className="flex justify-between items-center mb-2">
                <span className="text-studygo-textMuted">ãƒ—ãƒ©ãƒ³</span>
                <span className="font-medium text-studygo-text text-right text-sm">{selectedPlan?.name}</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-studygo-textMuted">æœˆé¡æ–™é‡‘</span>
                <span className="font-bold text-studygo-cyan text-lg">Â¥{(selectedPlan?.price || 0).toLocaleString()}</span>
              </div>
            </div>

            <button
              onClick={() => {
                setShowConfirmation(false);
                setStep(0);
                setQuestionStep(1);
                setFormData({ purpose: "", area: "", budget: "", name: "" });
                setSelectedStore(null);
                setSelectedPlan(null);
                setStores([]);
                setPlans([]);
              }}
              className="w-full py-3 bg-studygo-cyan text-white font-bold rounded-full hover:bg-studygo-cyanDark transition-all"
            >
              ãƒ‡ãƒ¢ã‚’æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
            </button>
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-studygo-mint">
          <Header />

          <main className="max-w-2xl mx-auto px-4 py-8">
            {isAnalyzing ? (
              <AnalyzingAnimation />
            ) : step === 0 ? (
              <LandingView />
            ) : step === 1 ? (
              <div className="slide-in">
                <QuestionCard title={getQuestionTitle()} subtitle={getQuestionSubtitle()}>
                  {renderQuestionContent()}

                  {/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}
                  <div className="flex items-center justify-between mt-8">
                    <button
                      onClick={prevQuestion}
                      disabled={questionStep === 1}
                      className="px-6 py-3 rounded-full border-2 border-gray-200 text-studygo-textLight hover:border-studygo-cyan hover:text-studygo-cyan transition-all disabled:opacity-30 disabled:cursor-not-allowed"
                    >
                      æˆ»ã‚‹
                    </button>
                    <button
                      type="button"
                      onClick={() => nextQuestion()}
                      className="px-8 py-3 bg-studygo-cyan text-white font-medium rounded-full hover:bg-studygo-cyanDark transition-all shadow-lg shadow-studygo-cyan/30 cursor-pointer"
                    >
                      {questionStep === totalQuestions ? 'AIã§åˆ†æã™ã‚‹' : 'æ¬¡ã¸'}
                    </button>
                  </div>
                </QuestionCard>
              </div>
            ) : (
              <ResultView />
            )}
          </main>

          <footer className="text-center py-6 text-sm text-studygo-textMuted">
            <p>Â© 2024 ã‚¹ã‚¿ãƒ‡ã‚£GOãƒ»ãƒ‘ãƒ¼ã‚½ãƒŠãƒ« - ãƒ‡ãƒ¢ç‰ˆ</p>
          </footer>

          {showConfirmation && <ConfirmationModal />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<StudyGoPersonal />);
  </script>
</body>
</html>
